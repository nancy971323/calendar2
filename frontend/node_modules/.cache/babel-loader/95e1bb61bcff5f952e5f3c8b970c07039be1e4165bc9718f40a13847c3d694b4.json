{"ast":null,"code":"import _regeneratorRuntime from \"/Users/lidiannan/Documents/GitHub/calendar2/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/lidiannan/Documents/GitHub/calendar2/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _toConsumableArray from \"/Users/lidiannan/Documents/GitHub/calendar2/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport { ref, computed, onMounted, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { useToast } from 'primevue/usetoast';\nimport { useConfirm } from 'primevue/useconfirm';\nimport moment from 'moment';\n\n// 安全等級徽章組件\nvar SecurityLevelBadge = {\n  props: {\n    level: String\n  },\n  setup: function setup(props) {\n    var getSecurityLevelClass = function getSecurityLevelClass() {\n      switch (props.level) {\n        case 'LEVEL_1':\n          return 'security-level-1';\n        case 'LEVEL_2':\n          return 'security-level-2';\n        case 'LEVEL_3':\n          return 'security-level-3';\n        case 'LEVEL_4':\n          return 'security-level-4';\n        default:\n          return '';\n      }\n    };\n    var getSecurityLevelName = function getSecurityLevelName() {\n      switch (props.level) {\n        case 'LEVEL_1':\n          return '最高權限';\n        case 'LEVEL_2':\n          return '高級權限';\n        case 'LEVEL_3':\n          return '中級權限';\n        case 'LEVEL_4':\n          return '基本權限';\n        default:\n          return props.level;\n      }\n    };\n    return {\n      getSecurityLevelClass: getSecurityLevelClass,\n      getSecurityLevelName: getSecurityLevelName\n    };\n  },\n  template: \"\\n    <span :class=\\\"['security-level-badge', getSecurityLevelClass()]\\\">\\n      {{ getSecurityLevelName() }}\\n    </span>\\n  \"\n};\nexport default {\n  name: 'EventManagement',\n  components: {\n    SecurityLevelBadge: SecurityLevelBadge\n  },\n  setup: function setup() {\n    var store = useStore();\n    var toast = useToast();\n    var confirm = useConfirm();\n\n    // 事件列表\n    var events = computed(function () {\n      return store.getters['calendar/events'];\n    });\n\n    // 篩選器\n    var filters = ref({\n      searchTerm: '',\n      year: new Date().getFullYear(),\n      month: new Date().getMonth() + 1,\n      securityLevel: null\n    });\n\n    // 根據篩選條件過濾事件\n    var filteredEvents = computed(function () {\n      var result = _toConsumableArray(events.value);\n\n      // 搜尋關鍵字過濾\n      if (filters.value.searchTerm) {\n        var search = filters.value.searchTerm.toLowerCase();\n        result = result.filter(function (event) {\n          return event.title.toLowerCase().includes(search) || event.description && event.description.toLowerCase().includes(search) || event.location && event.location.toLowerCase().includes(search);\n        });\n      }\n\n      // 安全等級過濾\n      if (filters.value.securityLevel) {\n        result = result.filter(function (event) {\n          return event.securityLevel === filters.value.securityLevel;\n        });\n      }\n      return result;\n    });\n\n    // 對話框狀態\n    var newEventDialog = ref(false);\n    var eventDetailsDialog = ref(false);\n    var editEventDialog = ref(false);\n\n    // 事件相關\n    var newEvent = ref({\n      title: '',\n      description: '',\n      startTime: null,\n      endTime: null,\n      location: '',\n      securityLevel: null,\n      specialViewerIds: []\n    });\n    var selectedEvent = ref(null);\n    var editingEvent = ref(null);\n    var savingEvent = ref(false);\n\n    // 下拉選項\n    var yearOptions = computed(function () {\n      var currentYear = new Date().getFullYear();\n      return [currentYear - 2, currentYear - 1, currentYear, currentYear + 1, currentYear + 2];\n    });\n    var monthOptions = ref([{\n      name: '一月',\n      value: 1\n    }, {\n      name: '二月',\n      value: 2\n    }, {\n      name: '三月',\n      value: 3\n    }, {\n      name: '四月',\n      value: 4\n    }, {\n      name: '五月',\n      value: 5\n    }, {\n      name: '六月',\n      value: 6\n    }, {\n      name: '七月',\n      value: 7\n    }, {\n      name: '八月',\n      value: 8\n    }, {\n      name: '九月',\n      value: 9\n    }, {\n      name: '十月',\n      value: 10\n    }, {\n      name: '十一月',\n      value: 11\n    }, {\n      name: '十二月',\n      value: 12\n    }]);\n\n    // 安全等級選項\n    var securityLevels = computed(function () {\n      return store.getters['employee/securityLevels'];\n    });\n    var securityLevelOptions = computed(function () {\n      if (!securityLevels.value) return [];\n      return Object.keys(securityLevels.value).map(function (level) {\n        return {\n          name: securityLevels.value[level].description,\n          value: level\n        };\n      });\n    });\n\n    // 計算屬性\n    var currentUser = computed(function () {\n      return store.getters['auth/currentUser'];\n    });\n    var employees = computed(function () {\n      return store.getters['employee/employees'];\n    });\n\n    // 低權限員工列表（用於特殊權限設定）\n    var lowerLevelEmployees = computed(function () {\n      if (!currentUser.value || !currentUser.value.securityLevel || !employees.value) return [];\n\n      // 根據當前用戶權限過濾低權限員工\n      var currentLevel = currentUser.value.securityLevel;\n      return employees.value.filter(function (emp) {\n        var empLevel = emp.securityLevel;\n\n        // 安全等級數字越小權限越高\n        return empLevel > currentLevel && emp.id !== currentUser.value.id;\n      });\n    });\n\n    // 特殊查看權限的員工顯示列表\n    var specialViewersDisplay = computed(function () {\n      if (!selectedEvent.value || !selectedEvent.value.specialViewerIds || !employees.value) return [];\n      return employees.value.filter(function (emp) {\n        return selectedEvent.value.specialViewerIds.includes(emp.id);\n      });\n    });\n\n    // 用戶權限相關\n    var isEventCreator = computed(function () {\n      return selectedEvent.value && currentUser.value && selectedEvent.value.creatorId === currentUser.value.id;\n    });\n    var canEditEvent = computed(function () {\n      return isEventCreator.value;\n    });\n    var canDeleteEvent = computed(function () {\n      return isEventCreator.value;\n    });\n    var canGrantSpecialPermissions = computed(function () {\n      return !!currentUser.value;\n    });\n\n    // 監聽年月變化，重新加載事件\n    watch([function () {\n      return filters.value.year;\n    }, function () {\n      return filters.value.month;\n    }], /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return loadEvents();\n          case 2:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    })));\n\n    // 加載事件\n    var loadEvents = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return store.dispatch('calendar/setCurrentDate', moment([filters.value.year, filters.value.month - 1, 1]).format('YYYY-MM-DD'));\n            case 3:\n              _context2.next = 5;\n              return store.dispatch('calendar/fetchMonthEvents');\n            case 5:\n              _context2.next = 10;\n              break;\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              toast.add({\n                severity: 'error',\n                summary: '錯誤',\n                detail: '無法加載事件',\n                life: 3000\n              });\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 7]]);\n      }));\n      return function loadEvents() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    // 重置篩選條件\n    var resetFilters = function resetFilters() {\n      filters.value = {\n        searchTerm: '',\n        year: new Date().getFullYear(),\n        month: new Date().getMonth() + 1,\n        securityLevel: null\n      };\n      loadEvents();\n    };\n\n    // 應用篩選\n    var applyFilters = function applyFilters() {\n      // 關鍵字搜尋不需要重新加載數據\n      if (filters.value.searchTerm || filters.value.securityLevel) {\n        return;\n      }\n      loadEvents();\n    };\n\n    // 打開新增事件對話框\n    var openNewEventDialog = function openNewEventDialog() {\n      resetNewEvent();\n\n      // 設置默認時間為今天\n      var now = moment();\n      newEvent.value.startTime = now.hour(9).minute(0).second(0).toDate();\n      newEvent.value.endTime = now.hour(10).minute(0).second(0).toDate();\n      newEventDialog.value = true;\n    };\n\n    // 重置新事件表單\n    var resetNewEvent = function resetNewEvent() {\n      var _currentUser$value;\n      newEvent.value = {\n        title: '',\n        description: '',\n        startTime: null,\n        endTime: null,\n        location: '',\n        securityLevel: ((_currentUser$value = currentUser.value) === null || _currentUser$value === void 0 ? void 0 : _currentUser$value.securityLevel) || null,\n        specialViewerIds: []\n      };\n    };\n\n    // 保存新事件\n    var saveNewEvent = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var _error$response;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              if (newEvent.value.title) {\n                _context3.next = 4;\n                break;\n              }\n              toast.add({\n                severity: 'warn',\n                summary: '提示',\n                detail: '請輸入事件標題',\n                life: 3000\n              });\n              return _context3.abrupt(\"return\");\n            case 4:\n              if (!(!newEvent.value.startTime || !newEvent.value.endTime)) {\n                _context3.next = 7;\n                break;\n              }\n              toast.add({\n                severity: 'warn',\n                summary: '提示',\n                detail: '請選擇開始和結束時間',\n                life: 3000\n              });\n              return _context3.abrupt(\"return\");\n            case 7:\n              if (!moment(newEvent.value.endTime).isBefore(moment(newEvent.value.startTime))) {\n                _context3.next = 10;\n                break;\n              }\n              toast.add({\n                severity: 'warn',\n                summary: '提示',\n                detail: '結束時間不能早於開始時間',\n                life: 3000\n              });\n              return _context3.abrupt(\"return\");\n            case 10:\n              savingEvent.value = true;\n              _context3.next = 13;\n              return store.dispatch('calendar/createEvent', newEvent.value);\n            case 13:\n              toast.add({\n                severity: 'success',\n                summary: '成功',\n                detail: '事件已創建',\n                life: 3000\n              });\n              newEventDialog.value = false;\n              resetNewEvent();\n\n              // 重新加載事件\n              _context3.next = 18;\n              return loadEvents();\n            case 18:\n              _context3.next = 23;\n              break;\n            case 20:\n              _context3.prev = 20;\n              _context3.t0 = _context3[\"catch\"](0);\n              toast.add({\n                severity: 'error',\n                summary: '錯誤',\n                detail: ((_error$response = _context3.t0.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || '創建事件失敗',\n                life: 3000\n              });\n            case 23:\n              _context3.prev = 23;\n              savingEvent.value = false;\n              return _context3.finish(23);\n            case 26:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, null, [[0, 20, 23, 26]]);\n      }));\n      return function saveNewEvent() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    // 查看事件詳情\n    var viewEvent = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(event) {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              selectedEvent.value = event;\n\n              // 獲取事件特殊權限\n              if (!(currentUser.value && event.creatorId === currentUser.value.id)) {\n                _context4.next = 10;\n                break;\n              }\n              _context4.prev = 2;\n              _context4.next = 5;\n              return store.dispatch('calendar/fetchEventPermissions', event.id);\n            case 5:\n              _context4.next = 10;\n              break;\n            case 7:\n              _context4.prev = 7;\n              _context4.t0 = _context4[\"catch\"](2);\n              console.error('無法獲取事件權限:', _context4.t0);\n            case 10:\n              eventDetailsDialog.value = true;\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[2, 7]]);\n      }));\n      return function viewEvent(_x) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    // 編輯事件\n    var editEvent = function editEvent(event) {\n      // 複製事件對象進行編輯\n      editingEvent.value = JSON.parse(JSON.stringify(event));\n\n      // 將字串日期轉換為Date物件\n      editingEvent.value.startTime = new Date(editingEvent.value.startTime);\n      editingEvent.value.endTime = new Date(editingEvent.value.endTime);\n      editEventDialog.value = true;\n    };\n\n    // 從詳情對話框編輯事件\n    var editEventFromDetails = function editEventFromDetails() {\n      eventDetailsDialog.value = false;\n      editEvent(selectedEvent.value);\n    };\n\n    // 保存編輯的事件\n    var saveEditedEvent = /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var _error$response2;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              if (editingEvent.value.title) {\n                _context5.next = 4;\n                break;\n              }\n              toast.add({\n                severity: 'warn',\n                summary: '提示',\n                detail: '請輸入事件標題',\n                life: 3000\n              });\n              return _context5.abrupt(\"return\");\n            case 4:\n              if (!(!editingEvent.value.startTime || !editingEvent.value.endTime)) {\n                _context5.next = 7;\n                break;\n              }\n              toast.add({\n                severity: 'warn',\n                summary: '提示',\n                detail: '請選擇開始和結束時間',\n                life: 3000\n              });\n              return _context5.abrupt(\"return\");\n            case 7:\n              if (!moment(editingEvent.value.endTime).isBefore(moment(editingEvent.value.startTime))) {\n                _context5.next = 10;\n                break;\n              }\n              toast.add({\n                severity: 'warn',\n                summary: '提示',\n                detail: '結束時間不能早於開始時間',\n                life: 3000\n              });\n              return _context5.abrupt(\"return\");\n            case 10:\n              savingEvent.value = true;\n              _context5.next = 13;\n              return store.dispatch('calendar/updateEvent', {\n                id: editingEvent.value.id,\n                eventData: editingEvent.value\n              });\n            case 13:\n              toast.add({\n                severity: 'success',\n                summary: '成功',\n                detail: '事件已更新',\n                life: 3000\n              });\n              editEventDialog.value = false;\n              editingEvent.value = null;\n\n              // 重新加載事件\n              _context5.next = 18;\n              return loadEvents();\n            case 18:\n              _context5.next = 23;\n              break;\n            case 20:\n              _context5.prev = 20;\n              _context5.t0 = _context5[\"catch\"](0);\n              toast.add({\n                severity: 'error',\n                summary: '錯誤',\n                detail: ((_error$response2 = _context5.t0.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || '更新事件失敗',\n                life: 3000\n              });\n            case 23:\n              _context5.prev = 23;\n              savingEvent.value = false;\n              return _context5.finish(23);\n            case 26:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, null, [[0, 20, 23, 26]]);\n      }));\n      return function saveEditedEvent() {\n        return _ref5.apply(this, arguments);\n      };\n    }();\n\n    // 確認刪除事件\n    var confirmDeleteEvent = function confirmDeleteEvent(event) {\n      confirm.require({\n        message: \"\\u78BA\\u5B9A\\u8981\\u522A\\u9664\\u4E8B\\u4EF6 \\\"\".concat(event.title, \"\\\" \\u55CE\\uFF1F\"),\n        header: '刪除確認',\n        icon: 'pi pi-exclamation-triangle',\n        acceptLabel: '確定',\n        rejectLabel: '取消',\n        accept: function accept() {\n          return deleteEvent(event);\n        }\n      });\n    };\n\n    // 從詳情對話框確認刪除事件\n    var confirmDeleteEventFromDetails = function confirmDeleteEventFromDetails() {\n      eventDetailsDialog.value = false;\n      confirmDeleteEvent(selectedEvent.value);\n    };\n\n    // 刪除事件\n    var deleteEvent = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(event) {\n        var _error$response3;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.prev = 0;\n              _context6.next = 3;\n              return store.dispatch('calendar/deleteEvent', event.id);\n            case 3:\n              toast.add({\n                severity: 'success',\n                summary: '成功',\n                detail: '事件已刪除',\n                life: 3000\n              });\n\n              // 重新加載事件\n              _context6.next = 6;\n              return loadEvents();\n            case 6:\n              _context6.next = 11;\n              break;\n            case 8:\n              _context6.prev = 8;\n              _context6.t0 = _context6[\"catch\"](0);\n              toast.add({\n                severity: 'error',\n                summary: '錯誤',\n                detail: ((_error$response3 = _context6.t0.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.data) || '刪除事件失敗',\n                life: 3000\n              });\n            case 11:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, null, [[0, 8]]);\n      }));\n      return function deleteEvent(_x2) {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n\n    // 工具方法\n    var formatDateTime = function formatDateTime(dateTimeStr) {\n      if (!dateTimeStr) return '';\n      return moment(dateTimeStr).format('YYYY/MM/DD HH:mm');\n    };\n    var formatEventDateTime = function formatEventDateTime(event) {\n      if (!event) return '';\n      var start = moment(event.startTime);\n      var end = moment(event.endTime);\n      if (start.isSame(end, 'day')) {\n        return \"\".concat(start.format('YYYY/MM/DD HH:mm'), \" - \").concat(end.format('HH:mm'));\n      } else {\n        return \"\".concat(start.format('YYYY/MM/DD HH:mm'), \" - \").concat(end.format('YYYY/MM/DD HH:mm'));\n      }\n    };\n    var getSecurityLevelName = function getSecurityLevelName(level) {\n      var _securityLevels$value;\n      if (!securityLevels.value || !level) return level;\n      return ((_securityLevels$value = securityLevels.value[level]) === null || _securityLevels$value === void 0 ? void 0 : _securityLevels$value.description) || level;\n    };\n\n    // 初始化\n    onMounted(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n      return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n        while (1) switch (_context7.prev = _context7.next) {\n          case 0:\n            _context7.prev = 0;\n            _context7.next = 3;\n            return store.dispatch('employee/fetchSecurityLevels');\n          case 3:\n            _context7.next = 8;\n            break;\n          case 5:\n            _context7.prev = 5;\n            _context7.t0 = _context7[\"catch\"](0);\n            console.error('無法加載安全等級:', _context7.t0);\n          case 8:\n            _context7.prev = 8;\n            _context7.next = 11;\n            return store.dispatch('employee/fetchActiveEmployees');\n          case 11:\n            _context7.next = 16;\n            break;\n          case 13:\n            _context7.prev = 13;\n            _context7.t1 = _context7[\"catch\"](8);\n            console.error('無法加載員工列表:', _context7.t1);\n          case 16:\n            _context7.next = 18;\n            return loadEvents();\n          case 18:\n          case \"end\":\n            return _context7.stop();\n        }\n      }, _callee7, null, [[0, 5], [8, 13]]);\n    })));\n    return {\n      events: events,\n      filteredEvents: filteredEvents,\n      filters: filters,\n      yearOptions: yearOptions,\n      monthOptions: monthOptions,\n      securityLevelOptions: securityLevelOptions,\n      newEventDialog: newEventDialog,\n      eventDetailsDialog: eventDetailsDialog,\n      editEventDialog: editEventDialog,\n      newEvent: newEvent,\n      selectedEvent: selectedEvent,\n      editingEvent: editingEvent,\n      savingEvent: savingEvent,\n      employees: employees,\n      lowerLevelEmployees: lowerLevelEmployees,\n      specialViewersDisplay: specialViewersDisplay,\n      isEventCreator: isEventCreator,\n      canEditEvent: canEditEvent,\n      canDeleteEvent: canDeleteEvent,\n      canGrantSpecialPermissions: canGrantSpecialPermissions,\n      resetFilters: resetFilters,\n      applyFilters: applyFilters,\n      openNewEventDialog: openNewEventDialog,\n      saveNewEvent: saveNewEvent,\n      viewEvent: viewEvent,\n      editEvent: editEvent,\n      editEventFromDetails: editEventFromDetails,\n      saveEditedEvent: saveEditedEvent,\n      confirmDeleteEvent: confirmDeleteEvent,\n      confirmDeleteEventFromDetails: confirmDeleteEventFromDetails,\n      formatDateTime: formatDateTime,\n      formatEventDateTime: formatEventDateTime,\n      getSecurityLevelName: getSecurityLevelName\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","useStore","useToast","useConfirm","moment","SecurityLevelBadge","props","level","String","setup","getSecurityLevelClass","getSecurityLevelName","template","name","components","store","toast","confirm","events","getters","filters","searchTerm","year","Date","getFullYear","month","getMonth","securityLevel","filteredEvents","result","_toConsumableArray","value","search","toLowerCase","filter","event","title","includes","description","location","newEventDialog","eventDetailsDialog","editEventDialog","newEvent","startTime","endTime","specialViewerIds","selectedEvent","editingEvent","savingEvent","yearOptions","currentYear","monthOptions","securityLevels","securityLevelOptions","Object","keys","map","currentUser","employees","lowerLevelEmployees","currentLevel","emp","empLevel","id","specialViewersDisplay","isEventCreator","creatorId","canEditEvent","canDeleteEvent","canGrantSpecialPermissions","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","loadEvents","stop","_ref2","_callee2","_callee2$","_context2","dispatch","format","t0","add","severity","summary","detail","life","apply","arguments","resetFilters","applyFilters","openNewEventDialog","resetNewEvent","now","hour","minute","second","toDate","_currentUser$value","saveNewEvent","_ref3","_callee3","_error$response","_callee3$","_context3","abrupt","isBefore","response","data","finish","viewEvent","_ref4","_callee4","_callee4$","_context4","console","error","_x","editEvent","JSON","parse","stringify","editEventFromDetails","saveEditedEvent","_ref5","_callee5","_error$response2","_callee5$","_context5","eventData","confirmDeleteEvent","require","message","concat","header","icon","acceptLabel","rejectLabel","accept","deleteEvent","confirmDeleteEventFromDetails","_ref6","_callee6","_error$response3","_callee6$","_context6","_x2","formatDateTime","dateTimeStr","formatEventDateTime","start","end","isSame","_securityLevels$value","_callee7","_callee7$","_context7","t1"],"sources":["/Users/lidiannan/Documents/GitHub/calendar2/frontend/src/components/EventManagement.vue"],"sourcesContent":["<template>\n  <div class=\"event-management-container\">\n    <div class=\"event-management-header\">\n      <h2>行事曆管理</h2>\n      <Button label=\"新增事件\" icon=\"pi pi-plus\" @click=\"openNewEventDialog\" />\n    </div>\n    \n    <div class=\"event-management-filters\">\n      <div class=\"filter-item\">\n        <span class=\"p-input-icon-left\">\n          <i class=\"pi pi-search\" />\n          <InputText v-model=\"filters.searchTerm\" placeholder=\"搜尋事件...\" @input=\"applyFilters\" />\n        </span>\n      </div>\n      \n      <div class=\"filter-item\">\n        <label>年份：</label>\n        <Dropdown v-model=\"filters.year\" :options=\"yearOptions\" placeholder=\"年份\" @change=\"applyFilters\" />\n      </div>\n      \n      <div class=\"filter-item\">\n        <label>月份：</label>\n        <Dropdown v-model=\"filters.month\" :options=\"monthOptions\" optionLabel=\"name\" optionValue=\"value\" placeholder=\"月份\" @change=\"applyFilters\" />\n      </div>\n      \n      <div class=\"filter-item\">\n        <label>安全等級：</label>\n        <Dropdown v-model=\"filters.securityLevel\" :options=\"securityLevelOptions\" optionLabel=\"name\" optionValue=\"value\" placeholder=\"安全等級\" @change=\"applyFilters\" />\n      </div>\n      \n      <Button icon=\"pi pi-filter-slash\" class=\"p-button-outlined\" @click=\"resetFilters\" />\n    </div>\n    \n    <div class=\"event-management-content\">\n      <DataTable\n        :value=\"filteredEvents\"\n        :paginator=\"true\"\n        :rows=\"10\"\n        :rowsPerPageOptions=\"[5, 10, 20, 50]\"\n        paginatorTemplate=\"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown\"\n        currentPageReportTemplate=\"顯示 {first} 到 {last} 共 {totalRecords} 筆記錄\"\n        responsiveLayout=\"scroll\"\n        stripedRows\n        class=\"event-table\"\n      >\n        <Column field=\"id\" header=\"ID\" style=\"width: 5%\"></Column>\n        <Column field=\"title\" header=\"標題\" style=\"width: 15%\"></Column>\n        <Column field=\"startTime\" header=\"開始時間\" style=\"width: 15%\">\n          <template #body=\"slotProps\">\n            {{ formatDateTime(slotProps.data.startTime) }}\n          </template>\n        </Column>\n        <Column field=\"endTime\" header=\"結束時間\" style=\"width: 15%\">\n          <template #body=\"slotProps\">\n            {{ formatDateTime(slotProps.data.endTime) }}\n          </template>\n        </Column>\n        <Column field=\"location\" header=\"地點\" style=\"width: 10%\"></Column>\n        <Column field=\"securityLevel\" header=\"安全等級\" style=\"width: 10%\">\n          <template #body=\"slotProps\">\n            <SecurityLevelBadge :level=\"slotProps.data.securityLevel\" />\n          </template>\n        </Column>\n        <Column field=\"creatorUsername\" header=\"創建者\" style=\"width: 10%\"></Column>\n        <Column header=\"操作\" style=\"width: 15%\">\n          <template #body=\"slotProps\">\n            <Button icon=\"pi pi-eye\" class=\"p-button-rounded p-button-info p-button-sm\" @click=\"viewEvent(slotProps.data)\" />\n            <Button icon=\"pi pi-pencil\" class=\"p-button-rounded p-button-secondary p-button-sm\" @click=\"editEvent(slotProps.data)\" />\n            <Button icon=\"pi pi-trash\" class=\"p-button-rounded p-button-danger p-button-sm\" @click=\"confirmDeleteEvent(slotProps.data)\" />\n          </template>\n        </Column>\n      </DataTable>\n    </div>\n    \n    <!-- 新增事件對話框 -->\n    <Dialog v-model:visible=\"newEventDialog\" header=\"新增事件\" :style=\"{ width: '500px' }\" :modal=\"true\">\n      <div class=\"p-fluid\">\n        <div class=\"p-field\">\n          <label for=\"event-title\">標題</label>\n          <InputText id=\"event-title\" v-model.trim=\"newEvent.title\" placeholder=\"事件標題\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"event-description\">描述</label>\n          <Textarea id=\"event-description\" v-model=\"newEvent.description\" rows=\"3\" placeholder=\"事件描述\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"event-start\">開始時間</label>\n          <Calendar id=\"event-start\" v-model=\"newEvent.startTime\" showTime hourFormat=\"24\" placeholder=\"開始時間\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"event-end\">結束時間</label>\n          <Calendar id=\"event-end\" v-model=\"newEvent.endTime\" showTime hourFormat=\"24\" placeholder=\"結束時間\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"event-location\">地點</label>\n          <InputText id=\"event-location\" v-model.trim=\"newEvent.location\" placeholder=\"事件地點\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"event-security-level\">安全等級</label>\n          <Dropdown id=\"event-security-level\" v-model=\"newEvent.securityLevel\" :options=\"securityLevelOptions\" optionLabel=\"name\" optionValue=\"value\" placeholder=\"選擇安全等級\" />\n        </div>\n        \n        <div class=\"p-field\" v-if=\"newEvent.securityLevel && canGrantSpecialPermissions\">\n          <label for=\"event-special-viewers\">特殊查看權限</label>\n          <MultiSelect\n            id=\"event-special-viewers\"\n            v-model=\"newEvent.specialViewerIds\"\n            :options=\"lowerLevelEmployees\"\n            optionLabel=\"fullName\"\n            optionValue=\"id\"\n            placeholder=\"可選擇低權限員工\"\n            display=\"chip\"\n          />\n        </div>\n      </div>\n      \n      <template #footer>\n        <Button label=\"取消\" icon=\"pi pi-times\" class=\"p-button-text\" @click=\"newEventDialog = false\" />\n        <Button label=\"儲存\" icon=\"pi pi-check\" @click=\"saveNewEvent\" :loading=\"savingEvent\" />\n      </template>\n    </Dialog>\n    \n    <!-- 事件詳情對話框 -->\n    <Dialog v-model:visible=\"eventDetailsDialog\" :header=\"selectedEvent?.title || '事件詳情'\" :style=\"{ width: '500px' }\" :modal=\"true\">\n      <div v-if=\"selectedEvent\" class=\"event-details\">\n        <div class=\"event-detail-item\">\n          <span class=\"detail-label\">時間：</span>\n          <span class=\"detail-value\">{{ formatEventDateTime(selectedEvent) }}</span>\n        </div>\n        \n        <div class=\"event-detail-item\">\n          <span class=\"detail-label\">地點：</span>\n          <span class=\"detail-value\">{{ selectedEvent.location || '無地點' }}</span>\n        </div>\n        \n        <div class=\"event-detail-item\">\n          <span class=\"detail-label\">安全等級：</span>\n          <span class=\"detail-value\">{{ getSecurityLevelName(selectedEvent.securityLevel) }}</span>\n        </div>\n        \n        <div class=\"event-detail-item\">\n          <span class=\"detail-label\">創建者：</span>\n          <span class=\"detail-value\">{{ selectedEvent.creatorUsername }}</span>\n        </div>\n        \n        <Divider />\n        \n        <div class=\"event-description\">\n          <h3>事件描述</h3>\n          <p>{{ selectedEvent.description || '無描述' }}</p>\n        </div>\n        \n        <div v-if=\"isEventCreator && specialViewersDisplay.length > 0\" class=\"event-special-viewers\">\n          <h3>特殊權限人員</h3>\n          <ul>\n            <li v-for=\"viewer in specialViewersDisplay\" :key=\"viewer.id\">\n              {{ viewer.fullName }}\n            </li>\n          </ul>\n        </div>\n      </div>\n      \n      <template #footer>\n        <div class=\"event-actions\">\n          <Button v-if=\"canEditEvent\" label=\"編輯\" icon=\"pi pi-pencil\" class=\"p-button-secondary\" @click=\"editEventFromDetails\" />\n          <Button v-if=\"canDeleteEvent\" label=\"刪除\" icon=\"pi pi-trash\" class=\"p-button-danger\" @click=\"confirmDeleteEventFromDetails\" />\n          <Button label=\"關閉\" icon=\"pi pi-times\" class=\"p-button-text\" @click=\"eventDetailsDialog = false\" />\n        </div>\n      </template>\n    </Dialog>\n    \n    <!-- 編輯事件對話框 -->\n    <Dialog v-model:visible=\"editEventDialog\" header=\"編輯事件\" :style=\"{ width: '500px' }\" :modal=\"true\">\n      <div v-if=\"editingEvent\" class=\"p-fluid\">\n        <div class=\"p-field\">\n          <label for=\"edit-event-title\">標題</label>\n          <InputText id=\"edit-event-title\" v-model.trim=\"editingEvent.title\" placeholder=\"事件標題\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"edit-event-description\">描述</label>\n          <Textarea id=\"edit-event-description\" v-model=\"editingEvent.description\" rows=\"3\" placeholder=\"事件描述\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"edit-event-start\">開始時間</label>\n          <Calendar id=\"edit-event-start\" v-model=\"editingEvent.startTime\" showTime hourFormat=\"24\" placeholder=\"開始時間\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"edit-event-end\">結束時間</label>\n          <Calendar id=\"edit-event-end\" v-model=\"editingEvent.endTime\" showTime hourFormat=\"24\" placeholder=\"結束時間\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"edit-event-location\">地點</label>\n          <InputText id=\"edit-event-location\" v-model.trim=\"editingEvent.location\" placeholder=\"事件地點\" />\n        </div>\n        \n        <div class=\"p-field\">\n          <label for=\"edit-event-security-level\">安全等級</label>\n          <Dropdown id=\"edit-event-security-level\" v-model=\"editingEvent.securityLevel\" :options=\"securityLevelOptions\" optionLabel=\"name\" optionValue=\"value\" placeholder=\"選擇安全等級\" />\n        </div>\n        \n        <div class=\"p-field\" v-if=\"editingEvent.securityLevel && canGrantSpecialPermissions\">\n          <label for=\"edit-event-special-viewers\">特殊查看權限</label>\n          <MultiSelect\n            id=\"edit-event-special-viewers\"\n            v-model=\"editingEvent.specialViewerIds\"\n            :options=\"lowerLevelEmployees\"\n            optionLabel=\"fullName\"\n            optionValue=\"id\"\n            placeholder=\"可選擇低權限員工\"\n            display=\"chip\"\n          />\n        </div>\n      </div>\n      \n      <template #footer>\n        <Button label=\"取消\" icon=\"pi pi-times\" class=\"p-button-text\" @click=\"editEventDialog = false\" />\n        <Button label=\"儲存\" icon=\"pi pi-check\" @click=\"saveEditedEvent\" :loading=\"savingEvent\" />\n      </template>\n    </Dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted, watch } from 'vue'\nimport { useStore } from 'vuex'\nimport { useToast } from 'primevue/usetoast'\nimport { useConfirm } from 'primevue/useconfirm'\nimport moment from 'moment'\n\n// 安全等級徽章組件\nconst SecurityLevelBadge = {\n  props: {\n    level: String\n  },\n  setup(props) {\n    const getSecurityLevelClass = () => {\n      switch(props.level) {\n        case 'LEVEL_1': return 'security-level-1'\n        case 'LEVEL_2': return 'security-level-2'\n        case 'LEVEL_3': return 'security-level-3'\n        case 'LEVEL_4': return 'security-level-4'\n        default: return ''\n      }\n    }\n    \n    const getSecurityLevelName = () => {\n      switch(props.level) {\n        case 'LEVEL_1': return '最高權限'\n        case 'LEVEL_2': return '高級權限'\n        case 'LEVEL_3': return '中級權限'\n        case 'LEVEL_4': return '基本權限'\n        default: return props.level\n      }\n    }\n    \n    return {\n      getSecurityLevelClass,\n      getSecurityLevelName\n    }\n  },\n  template: `\n    <span :class=\"['security-level-badge', getSecurityLevelClass()]\">\n      {{ getSecurityLevelName() }}\n    </span>\n  `\n}\n\nexport default {\n  name: 'EventManagement',\n  \n  components: {\n    SecurityLevelBadge\n  },\n  \n  setup() {\n    const store = useStore()\n    const toast = useToast()\n    const confirm = useConfirm()\n    \n    // 事件列表\n    const events = computed(() => store.getters['calendar/events'])\n    \n    // 篩選器\n    const filters = ref({\n      searchTerm: '',\n      year: new Date().getFullYear(),\n      month: new Date().getMonth() + 1,\n      securityLevel: null\n    })\n    \n    // 根據篩選條件過濾事件\n    const filteredEvents = computed(() => {\n      let result = [...events.value]\n      \n      // 搜尋關鍵字過濾\n      if (filters.value.searchTerm) {\n        const search = filters.value.searchTerm.toLowerCase()\n        result = result.filter(event => \n          event.title.toLowerCase().includes(search) ||\n          (event.description && event.description.toLowerCase().includes(search)) ||\n          (event.location && event.location.toLowerCase().includes(search))\n        )\n      }\n      \n      // 安全等級過濾\n      if (filters.value.securityLevel) {\n        result = result.filter(event => event.securityLevel === filters.value.securityLevel)\n      }\n      \n      return result\n    })\n    \n    // 對話框狀態\n    const newEventDialog = ref(false)\n    const eventDetailsDialog = ref(false)\n    const editEventDialog = ref(false)\n    \n    // 事件相關\n    const newEvent = ref({\n      title: '',\n      description: '',\n      startTime: null,\n      endTime: null,\n      location: '',\n      securityLevel: null,\n      specialViewerIds: []\n    })\n    \n    const selectedEvent = ref(null)\n    const editingEvent = ref(null)\n    const savingEvent = ref(false)\n    \n    // 下拉選項\n    const yearOptions = computed(() => {\n      const currentYear = new Date().getFullYear()\n      return [\n        currentYear - 2,\n        currentYear - 1,\n        currentYear,\n        currentYear + 1,\n        currentYear + 2\n      ]\n    })\n    \n    const monthOptions = ref([\n      { name: '一月', value: 1 },\n      { name: '二月', value: 2 },\n      { name: '三月', value: 3 },\n      { name: '四月', value: 4 },\n      { name: '五月', value: 5 },\n      { name: '六月', value: 6 },\n      { name: '七月', value: 7 },\n      { name: '八月', value: 8 },\n      { name: '九月', value: 9 },\n      { name: '十月', value: 10 },\n      { name: '十一月', value: 11 },\n      { name: '十二月', value: 12 }\n    ])\n    \n    // 安全等級選項\n    const securityLevels = computed(() => store.getters['employee/securityLevels'])\n    \n    const securityLevelOptions = computed(() => {\n      if (!securityLevels.value) return []\n      \n      return Object.keys(securityLevels.value).map(level => ({\n        name: securityLevels.value[level].description,\n        value: level\n      }))\n    })\n    \n    // 計算屬性\n    const currentUser = computed(() => store.getters['auth/currentUser'])\n    const employees = computed(() => store.getters['employee/employees'])\n    \n    // 低權限員工列表（用於特殊權限設定）\n    const lowerLevelEmployees = computed(() => {\n      if (!currentUser.value || !currentUser.value.securityLevel || !employees.value) return []\n      \n      // 根據當前用戶權限過濾低權限員工\n      const currentLevel = currentUser.value.securityLevel\n      return employees.value.filter(emp => {\n        const empLevel = emp.securityLevel\n        \n        // 安全等級數字越小權限越高\n        return empLevel > currentLevel && emp.id !== currentUser.value.id\n      })\n    })\n    \n    // 特殊查看權限的員工顯示列表\n    const specialViewersDisplay = computed(() => {\n      if (!selectedEvent.value || !selectedEvent.value.specialViewerIds || !employees.value) return []\n      \n      return employees.value.filter(emp => \n        selectedEvent.value.specialViewerIds.includes(emp.id)\n      )\n    })\n    \n    // 用戶權限相關\n    const isEventCreator = computed(() => {\n      return selectedEvent.value && currentUser.value && \n             selectedEvent.value.creatorId === currentUser.value.id\n    })\n    \n    const canEditEvent = computed(() => isEventCreator.value)\n    \n    const canDeleteEvent = computed(() => isEventCreator.value)\n    \n    const canGrantSpecialPermissions = computed(() => !!currentUser.value)\n    \n    // 監聽年月變化，重新加載事件\n    watch([() => filters.value.year, () => filters.value.month], async () => {\n      await loadEvents()\n    })\n    \n    // 加載事件\n    const loadEvents = async () => {\n      try {\n        await store.dispatch('calendar/setCurrentDate', \n          moment([filters.value.year, filters.value.month - 1, 1]).format('YYYY-MM-DD')\n        )\n        await store.dispatch('calendar/fetchMonthEvents')\n      } catch (error) {\n        toast.add({\n          severity: 'error',\n          summary: '錯誤',\n          detail: '無法加載事件',\n          life: 3000\n        })\n      }\n    }\n    \n    // 重置篩選條件\n    const resetFilters = () => {\n      filters.value = {\n        searchTerm: '',\n        year: new Date().getFullYear(),\n        month: new Date().getMonth() + 1,\n        securityLevel: null\n      }\n      loadEvents()\n    }\n    \n    // 應用篩選\n    const applyFilters = () => {\n      // 關鍵字搜尋不需要重新加載數據\n      if (filters.value.searchTerm || filters.value.securityLevel) {\n        return\n      }\n      \n      loadEvents()\n    }\n    \n    // 打開新增事件對話框\n    const openNewEventDialog = () => {\n      resetNewEvent()\n      \n      // 設置默認時間為今天\n      const now = moment()\n      newEvent.value.startTime = now.hour(9).minute(0).second(0).toDate()\n      newEvent.value.endTime = now.hour(10).minute(0).second(0).toDate()\n      \n      newEventDialog.value = true\n    }\n    \n    // 重置新事件表單\n    const resetNewEvent = () => {\n      newEvent.value = {\n        title: '',\n        description: '',\n        startTime: null,\n        endTime: null,\n        location: '',\n        securityLevel: currentUser.value?.securityLevel || null,\n        specialViewerIds: []\n      }\n    }\n    \n    // 保存新事件\n    const saveNewEvent = async () => {\n      try {\n        // 表單驗證\n        if (!newEvent.value.title) {\n          toast.add({\n            severity: 'warn',\n            summary: '提示',\n            detail: '請輸入事件標題',\n            life: 3000\n          })\n          return\n        }\n        \n        if (!newEvent.value.startTime || !newEvent.value.endTime) {\n          toast.add({\n            severity: 'warn',\n            summary: '提示',\n            detail: '請選擇開始和結束時間',\n            life: 3000\n          })\n          return\n        }\n        \n        if (moment(newEvent.value.endTime).isBefore(moment(newEvent.value.startTime))) {\n          toast.add({\n            severity: 'warn',\n            summary: '提示',\n            detail: '結束時間不能早於開始時間',\n            life: 3000\n          })\n          return\n        }\n        \n        savingEvent.value = true\n        \n        await store.dispatch('calendar/createEvent', newEvent.value)\n        \n        toast.add({\n          severity: 'success',\n          summary: '成功',\n          detail: '事件已創建',\n          life: 3000\n        })\n        \n        newEventDialog.value = false\n        resetNewEvent()\n        \n        // 重新加載事件\n        await loadEvents()\n      } catch (error) {\n        toast.add({\n          severity: 'error',\n          summary: '錯誤',\n          detail: error.response?.data || '創建事件失敗',\n          life: 3000\n        })\n      } finally {\n        savingEvent.value = false\n      }\n    }\n    \n    // 查看事件詳情\n    const viewEvent = async (event) => {\n      selectedEvent.value = event\n      \n      // 獲取事件特殊權限\n      if (currentUser.value && event.creatorId === currentUser.value.id) {\n        try {\n          await store.dispatch('calendar/fetchEventPermissions', event.id)\n        } catch (error) {\n          console.error('無法獲取事件權限:', error)\n        }\n      }\n      \n      eventDetailsDialog.value = true\n    }\n    \n    // 編輯事件\n    const editEvent = (event) => {\n      // 複製事件對象進行編輯\n      editingEvent.value = JSON.parse(JSON.stringify(event))\n      \n      // 將字串日期轉換為Date物件\n      editingEvent.value.startTime = new Date(editingEvent.value.startTime)\n      editingEvent.value.endTime = new Date(editingEvent.value.endTime)\n      \n      editEventDialog.value = true\n    }\n    \n    // 從詳情對話框編輯事件\n    const editEventFromDetails = () => {\n      eventDetailsDialog.value = false\n      editEvent(selectedEvent.value)\n    }\n    \n    // 保存編輯的事件\n    const saveEditedEvent = async () => {\n      try {\n        // 表單驗證\n        if (!editingEvent.value.title) {\n          toast.add({\n            severity: 'warn',\n            summary: '提示',\n            detail: '請輸入事件標題',\n            life: 3000\n          })\n          return\n        }\n        \n        if (!editingEvent.value.startTime || !editingEvent.value.endTime) {\n          toast.add({\n            severity: 'warn',\n            summary: '提示',\n            detail: '請選擇開始和結束時間',\n            life: 3000\n          })\n          return\n        }\n        \n        if (moment(editingEvent.value.endTime).isBefore(moment(editingEvent.value.startTime))) {\n          toast.add({\n            severity: 'warn',\n            summary: '提示',\n            detail: '結束時間不能早於開始時間',\n            life: 3000\n          })\n          return\n        }\n        \n        savingEvent.value = true\n        \n        await store.dispatch('calendar/updateEvent', {\n          id: editingEvent.value.id,\n          eventData: editingEvent.value\n        })\n        \n        toast.add({\n          severity: 'success',\n          summary: '成功',\n          detail: '事件已更新',\n          life: 3000\n        })\n        \n        editEventDialog.value = false\n        editingEvent.value = null\n        \n        // 重新加載事件\n        await loadEvents()\n      } catch (error) {\n        toast.add({\n          severity: 'error',\n          summary: '錯誤',\n          detail: error.response?.data || '更新事件失敗',\n          life: 3000\n        })\n      } finally {\n        savingEvent.value = false\n      }\n    }\n    \n    // 確認刪除事件\n    const confirmDeleteEvent = (event) => {\n      confirm.require({\n        message: `確定要刪除事件 \"${event.title}\" 嗎？`,\n        header: '刪除確認',\n        icon: 'pi pi-exclamation-triangle',\n        acceptLabel: '確定',\n        rejectLabel: '取消',\n        accept: () => deleteEvent(event)\n      })\n    }\n    \n    // 從詳情對話框確認刪除事件\n    const confirmDeleteEventFromDetails = () => {\n      eventDetailsDialog.value = false\n      confirmDeleteEvent(selectedEvent.value)\n    }\n    \n    // 刪除事件\n    const deleteEvent = async (event) => {\n      try {\n        await store.dispatch('calendar/deleteEvent', event.id)\n        \n        toast.add({\n          severity: 'success',\n          summary: '成功',\n          detail: '事件已刪除',\n          life: 3000\n        })\n        \n        // 重新加載事件\n        await loadEvents()\n      } catch (error) {\n        toast.add({\n          severity: 'error',\n          summary: '錯誤',\n          detail: error.response?.data || '刪除事件失敗',\n          life: 3000\n        })\n      }\n    }\n    \n    // 工具方法\n    const formatDateTime = (dateTimeStr) => {\n      if (!dateTimeStr) return ''\n      return moment(dateTimeStr).format('YYYY/MM/DD HH:mm')\n    }\n    \n    const formatEventDateTime = (event) => {\n      if (!event) return ''\n      \n      const start = moment(event.startTime)\n      const end = moment(event.endTime)\n      \n      if (start.isSame(end, 'day')) {\n        return `${start.format('YYYY/MM/DD HH:mm')} - ${end.format('HH:mm')}`\n      } else {\n        return `${start.format('YYYY/MM/DD HH:mm')} - ${end.format('YYYY/MM/DD HH:mm')}`\n      }\n    }\n    \n    const getSecurityLevelName = (level) => {\n      if (!securityLevels.value || !level) return level\n      \n      return securityLevels.value[level]?.description || level\n    }\n    \n    // 初始化\n    onMounted(async () => {\n      // 加載安全等級\n      try {\n        await store.dispatch('employee/fetchSecurityLevels')\n      } catch (error) {\n        console.error('無法加載安全等級:', error)\n      }\n      \n      // 加載員工列表\n      try {\n        await store.dispatch('employee/fetchActiveEmployees')\n      } catch (error) {\n        console.error('無法加載員工列表:', error)\n      }\n      \n      // 加載事件\n      await loadEvents()\n    })\n    \n    return {\n      events,\n      filteredEvents,\n      filters,\n      yearOptions,\n      monthOptions,\n      securityLevelOptions,\n      newEventDialog,\n      eventDetailsDialog,\n      editEventDialog,\n      newEvent,\n      selectedEvent,\n      editingEvent,\n      savingEvent,\n      employees,\n      lowerLevelEmployees,\n      specialViewersDisplay,\n      isEventCreator,\n      canEditEvent,\n      canDeleteEvent,\n      canGrantSpecialPermissions,\n      resetFilters,\n      applyFilters,\n      openNewEventDialog,\n      saveNewEvent,\n      viewEvent,\n      editEvent,\n      editEventFromDetails,\n      saveEditedEvent,\n      confirmDeleteEvent,\n      confirmDeleteEventFromDetails,\n      formatDateTime,\n      formatEventDateTime,\n      getSecurityLevelName\n    }\n  }\n}\n</script>\n\n<style scoped>\n.event-management-container {\n  padding: 1rem 0;\n}\n\n.event-management-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n}\n\n.event-management-header h2 {\n  margin: 0;\n  color: #3B82F6;\n}\n\n.event-management-filters {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n  align-items: center;\n  background-color: #f8f9fa;\n  padding: 1rem;\n  border-radius: 8px;\n}\n\n.filter-item {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.event-table {\n  margin-top: 1rem;\n}\n\n:deep(.security-level-badge) {\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n  font-weight: bold;\n}\n\n:deep(.security-level-1) {\n  background-color: #ffcdd2;\n  color: #c62828;\n}\n\n:deep(.security-level-2) {\n  background-color: #fff9c4;\n  color: #f57f17;\n}\n\n:deep(.security-level-3) {\n  background-color: #b3e5fc;\n  color: #0277bd;\n}\n\n:deep(.security-level-4) {\n  background-color: #c8e6c9;\n  color: #2e7d32;\n}\n\n/* 事件詳情 */\n.event-details {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n.event-detail-item {\n  display: flex;\n}\n\n.detail-label {\n  font-weight: 600;\n  width: 80px;\n}\n\n.event-description h3, .event-special-viewers h3 {\n  margin-top: 0.5rem;\n  margin-bottom: 0.5rem;\n  font-size: 1rem;\n}\n\n.event-actions {\n  display: flex;\n  gap: 0.5rem;\n}\n\n.p-field {\n  margin-bottom: 1.5rem;\n}\n\n@media (max-width: 768px) {\n  .event-management-filters {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n  \n  .filter-item {\n    width: 100%;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}