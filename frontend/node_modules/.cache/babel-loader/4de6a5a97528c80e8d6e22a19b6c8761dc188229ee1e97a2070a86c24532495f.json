{"ast":null,"code":"import _regeneratorRuntime from \"/Users/lidiannan/Documents/GitHub/calendar2/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/lidiannan/Documents/GitHub/calendar2/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport { computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nexport default {\n  name: 'App',\n  setup: function setup() {\n    var store = useStore();\n    var router = useRouter();\n\n    // 計算屬性\n    var isLoggedIn = computed(function () {\n      return store.getters['auth/isAuthenticated'];\n    });\n    var currentUser = computed(function () {\n      return store.getters['auth/currentUser'];\n    });\n    var securityLevelText = computed(function () {\n      if (!currentUser.value || !currentUser.value.securityLevel) return '';\n      var level = currentUser.value.securityLevel;\n      switch (level) {\n        case 'LEVEL_1':\n          return '最高權限';\n        case 'LEVEL_2':\n          return '高級權限';\n        case 'LEVEL_3':\n          return '中級權限';\n        case 'LEVEL_4':\n          return '基本權限';\n        default:\n          return level;\n      }\n    });\n    var hasHighestAuth = computed(function () {\n      if (!currentUser.value || !currentUser.value.securityLevel) return false;\n      return currentUser.value.securityLevel === 'LEVEL_1';\n    });\n\n    // 方法\n    var logout = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return store.dispatch('auth/logout');\n            case 3:\n              router.push('/login');\n              _context.next = 9;\n              break;\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](0);\n              console.error('登出失敗:', _context.t0);\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 6]]);\n      }));\n      return function logout() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    // 生命週期鉤子\n    onMounted(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var token;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            // 如果本地存儲中有token，嘗試自動登入\n            token = localStorage.getItem('token');\n            if (!token) {\n              _context2.next = 11;\n              break;\n            }\n            _context2.prev = 2;\n            _context2.next = 5;\n            return store.dispatch('auth/checkAuth');\n          case 5:\n            _context2.next = 11;\n            break;\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2[\"catch\"](2);\n            console.error('Token驗證失敗:', _context2.t0);\n            localStorage.removeItem('token');\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2, null, [[2, 7]]);\n    })));\n    return {\n      isLoggedIn: isLoggedIn,\n      currentUser: currentUser,\n      securityLevelText: securityLevelText,\n      hasHighestAuth: hasHighestAuth,\n      logout: logout\n    };\n  }\n};","map":{"version":3,"names":["computed","onMounted","useStore","useRouter","name","setup","store","router","isLoggedIn","getters","currentUser","securityLevelText","value","securityLevel","level","hasHighestAuth","logout","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","dispatch","push","t0","console","error","stop","apply","arguments","_callee2","token","_callee2$","_context2","localStorage","getItem","removeItem"],"sources":["/Users/lidiannan/Documents/GitHub/calendar2/frontend/src/App.vue"],"sourcesContent":["<template>\n  <div id=\"app\">\n    <Toast position=\"top-right\" />\n    <ConfirmDialog></ConfirmDialog>\n    <div class=\"layout-container\">\n      <header v-if=\"isLoggedIn\">\n        <div class=\"header-content\">\n          <div class=\"header-logo\">\n            <router-link to=\"/\">企業行事曆系統</router-link>\n          </div>\n          <div class=\"header-menu\">\n            <Button @click=\"$router.push('/')\" label=\"首頁\" icon=\"pi pi-home\" class=\"p-button-text\" />\n            <Button @click=\"$router.push('/calendar')\" label=\"行事曆\" icon=\"pi pi-calendar\" class=\"p-button-text\" />\n            <Button v-if=\"isLoggedIn && hasHighestAuth\" @click=\"$router.push('/admin')\" label=\"後臺管理\" icon=\"pi pi-cog\" class=\"p-button-text\" />\n          </div>\n          <div class=\"header-user\" v-if=\"isLoggedIn\">\n            <span class=\"user-info\">{{ currentUser.fullName }} ({{ securityLevelText }})</span>\n            <Button @click=\"logout\" label=\"登出\" icon=\"pi pi-sign-out\" class=\"p-button-text\" />\n          </div>\n        </div>\n      </header>\n      <main class=\"main-content\">\n        <router-view />\n      </main>\n      <footer v-if=\"isLoggedIn\">\n        <div class=\"footer-content\">\n          <p>&copy; 2025 企業行事曆系統</p>\n        </div>\n      </footer>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { computed, onMounted } from 'vue'\nimport { useStore } from 'vuex'\nimport { useRouter } from 'vue-router'\n\nexport default {\n  name: 'App',\n  setup() {\n    const store = useStore()\n    const router = useRouter()\n\n    // 計算屬性\n    const isLoggedIn = computed(() => store.getters['auth/isAuthenticated'])\n    const currentUser = computed(() => store.getters['auth/currentUser'])\n    const securityLevelText = computed(() => {\n      if (!currentUser.value || !currentUser.value.securityLevel) return ''\n      \n      const level = currentUser.value.securityLevel\n      switch(level) {\n        case 'LEVEL_1': return '最高權限'\n        case 'LEVEL_2': return '高級權限'\n        case 'LEVEL_3': return '中級權限'\n        case 'LEVEL_4': return '基本權限'\n        default: return level\n      }\n    })\n    const hasHighestAuth = computed(() => {\n      if (!currentUser.value || !currentUser.value.securityLevel) return false\n      return currentUser.value.securityLevel === 'LEVEL_1'\n    })\n\n    // 方法\n    const logout = async () => {\n      try {\n        await store.dispatch('auth/logout')\n        router.push('/login')\n      } catch (error) {\n        console.error('登出失敗:', error)\n      }\n    }\n\n    // 生命週期鉤子\n    onMounted(async () => {\n      // 如果本地存儲中有token，嘗試自動登入\n      const token = localStorage.getItem('token')\n      if (token) {\n        try {\n          await store.dispatch('auth/checkAuth')\n        } catch (error) {\n          console.error('Token驗證失敗:', error)\n          localStorage.removeItem('token')\n        }\n      }\n    })\n\n    return {\n      isLoggedIn,\n      currentUser,\n      securityLevelText,\n      hasHighestAuth,\n      logout\n    }\n  }\n}\n</script>\n\n<style>\nhtml, body {\n  margin: 0;\n  padding: 0;\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n  height: 100%;\n}\n\n#app {\n  height: 100%;\n}\n\n.layout-container {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n}\n\nheader {\n  background-color: #ffffff;\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n  padding: 0.5rem 2rem;\n}\n\n.header-content {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.header-logo a {\n  color: #3B82F6;\n  font-size: 1.5rem;\n  font-weight: 700;\n  text-decoration: none;\n}\n\n.header-menu {\n  display: flex;\n  gap: 1rem;\n}\n\n.header-user {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.user-info {\n  font-weight: 600;\n}\n\n.main-content {\n  flex: 1;\n  padding: 2rem;\n  background-color: #f8f9fa;\n}\n\nfooter {\n  background-color: #ffffff;\n  padding: 1rem 2rem;\n  border-top: 1px solid #e9ecef;\n}\n\n.footer-content {\n  text-align: center;\n  color: #6c757d;\n}\n</style>"],"mappings":";;;AAkCA,SAASA,QAAQ,EAAEC,SAAQ,QAAS,KAAI;AACxC,SAASC,QAAO,QAAS,MAAK;AAC9B,SAASC,SAAQ,QAAS,YAAW;AAErC,eAAe;EACbC,IAAI,EAAE,KAAK;EACXC,KAAK,WAALA,KAAKA,CAAA,EAAG;IACN,IAAMC,KAAI,GAAIJ,QAAQ,CAAC;IACvB,IAAMK,MAAK,GAAIJ,SAAS,CAAC;;IAEzB;IACA,IAAMK,UAAS,GAAIR,QAAQ,CAAC;MAAA,OAAMM,KAAK,CAACG,OAAO,CAAC,sBAAsB,CAAC;IAAA;IACvE,IAAMC,WAAU,GAAIV,QAAQ,CAAC;MAAA,OAAMM,KAAK,CAACG,OAAO,CAAC,kBAAkB,CAAC;IAAA;IACpE,IAAME,iBAAgB,GAAIX,QAAQ,CAAC,YAAM;MACvC,IAAI,CAACU,WAAW,CAACE,KAAI,IAAK,CAACF,WAAW,CAACE,KAAK,CAACC,aAAa,EAAE,OAAO,EAAC;MAEpE,IAAMC,KAAI,GAAIJ,WAAW,CAACE,KAAK,CAACC,aAAY;MAC5C,QAAOC,KAAK;QACV,KAAK,SAAS;UAAE,OAAO,MAAK;QAC5B,KAAK,SAAS;UAAE,OAAO,MAAK;QAC5B,KAAK,SAAS;UAAE,OAAO,MAAK;QAC5B,KAAK,SAAS;UAAE,OAAO,MAAK;QAC5B;UAAS,OAAOA,KAAI;MACtB;IACF,CAAC;IACD,IAAMC,cAAa,GAAIf,QAAQ,CAAC,YAAM;MACpC,IAAI,CAACU,WAAW,CAACE,KAAI,IAAK,CAACF,WAAW,CAACE,KAAK,CAACC,aAAa,EAAE,OAAO,KAAI;MACvE,OAAOH,WAAW,CAACE,KAAK,CAACC,aAAY,KAAM,SAAQ;IACrD,CAAC;;IAED;IACA,IAAMG,MAAK;MAAA,IAAAC,IAAA,GAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAI,SAAAC,QAAA;QAAA,OAAAF,mBAAA,GAAAG,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAELpB,KAAK,CAACqB,QAAQ,CAAC,aAAa;YAAA;cAClCpB,MAAM,CAACqB,IAAI,CAAC,QAAQ;cAAAJ,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAK,EAAA,GAAAL,QAAA;cAEpBM,OAAO,CAACC,KAAK,CAAC,OAAO,EAAAP,QAAA,CAAAK,EAAO;YAAA;YAAA;cAAA,OAAAL,QAAA,CAAAQ,IAAA;UAAA;QAAA,GAAAX,OAAA;MAAA,CAEhC;MAAA,gBAPML,MAAKA,CAAA;QAAA,OAAAC,IAAA,CAAAgB,KAAA,OAAAC,SAAA;MAAA;IAAA,GAOX;;IAEA;IACAjC,SAAS,cAAAiB,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAAe,SAAA;MAAA,IAAAC,KAAA;MAAA,OAAAjB,mBAAA,GAAAG,IAAA,UAAAe,UAAAC,SAAA;QAAA,kBAAAA,SAAA,CAAAb,IAAA,GAAAa,SAAA,CAAAZ,IAAA;UAAA;YACR;YACMU,KAAI,GAAIG,YAAY,CAACC,OAAO,CAAC,OAAO;YAAA,KACtCJ,KAAK;cAAAE,SAAA,CAAAZ,IAAA;cAAA;YAAA;YAAAY,SAAA,CAAAb,IAAA;YAAAa,SAAA,CAAAZ,IAAA;YAAA,OAECpB,KAAK,CAACqB,QAAQ,CAAC,gBAAgB;UAAA;YAAAW,SAAA,CAAAZ,IAAA;YAAA;UAAA;YAAAY,SAAA,CAAAb,IAAA;YAAAa,SAAA,CAAAT,EAAA,GAAAS,SAAA;YAErCR,OAAO,CAACC,KAAK,CAAC,YAAY,EAAAO,SAAA,CAAAT,EAAO;YACjCU,YAAY,CAACE,UAAU,CAAC,OAAO;UAAA;UAAA;YAAA,OAAAH,SAAA,CAAAN,IAAA;QAAA;MAAA,GAAAG,QAAA;IAAA,CAGpC;IAED,OAAO;MACL3B,UAAU,EAAVA,UAAU;MACVE,WAAW,EAAXA,WAAW;MACXC,iBAAiB,EAAjBA,iBAAiB;MACjBI,cAAc,EAAdA,cAAc;MACdC,MAAK,EAALA;IACF;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}